---
interface Props {
  variant?: 'footer' | 'inline' | 'full';
}

const { variant = 'footer' } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
---

{variant === 'footer' && (
  <div class="newsletter-signup">
    <h3 class="font-display text-lg font-bold mb-2">Stay Informed</h3>
    <p class="text-fd-muted text-sm mb-4">
      Get notified about new articles, cold case updates, and victim resources.
    </p>
    <form class="newsletter-form flex gap-2" data-variant="footer">
      <input
        type="email"
        name="email"
        placeholder="your@email.com"
        required
        class="flex-1 px-3 py-2 bg-noir-elevated border border-noir-border rounded text-sm text-fd-text placeholder-fd-muted focus:border-amber focus:outline-none"
      />
      <button
        type="submit"
        class="px-4 py-2 bg-amber text-noir-bg text-sm font-medium rounded hover:bg-amber-bright transition-colors"
      >
        Subscribe
      </button>
    </form>
    <p class="text-xs text-fd-muted mt-2">No spam. Unsubscribe anytime.</p>
    <p class="newsletter-success hidden text-sm text-green-400 mt-2">
      Thanks for subscribing! Check your email to confirm.
    </p>
  </div>
)}

{variant === 'inline' && (
  <div class="newsletter-signup p-6 bg-fd-card rounded-lg">
    <div class="flex flex-col md:flex-row md:items-center gap-4">
      <div class="flex-1">
        <h3 class="font-display font-bold mb-1">Subscribe to Forensic Darkness</h3>
        <p class="text-fd-muted text-sm">New articles and cold case updates in your inbox.</p>
      </div>
      <form class="newsletter-form flex gap-2" data-variant="inline">
        <input
          type="email"
          name="email"
          placeholder="your@email.com"
          required
          class="px-3 py-2 bg-noir-elevated border border-noir-border rounded text-sm text-fd-text placeholder-fd-muted focus:border-amber focus:outline-none min-w-[200px]"
        />
        <button
          type="submit"
          class="px-4 py-2 bg-amber text-noir-bg text-sm font-medium rounded hover:bg-amber-bright transition-colors whitespace-nowrap"
        >
          Subscribe
        </button>
      </form>
    </div>
    <p class="newsletter-success hidden text-sm text-green-400 mt-2">
      Thanks for subscribing! Check your email to confirm.
    </p>
  </div>
)}

{variant === 'full' && (
  <div class="newsletter-signup p-8 bg-gradient-to-br from-noir-surface to-fd-card border border-noir-border rounded-lg text-center">
    <h2 class="text-2xl font-display font-bold mb-2">Join the Investigation</h2>
    <p class="text-fd-muted mb-6 max-w-md mx-auto">
      Subscribe to receive new articles, cold case spotlights, and victim advocacy
      resources directly in your inbox.
    </p>
    <form class="newsletter-form max-w-md mx-auto" data-variant="full">
      <div class="flex gap-2">
        <input
          type="email"
          name="email"
          placeholder="Enter your email"
          required
          class="flex-1 px-4 py-3 bg-noir-elevated border border-noir-border rounded text-fd-text placeholder-fd-muted focus:border-amber focus:outline-none"
        />
        <button
          type="submit"
          class="px-6 py-3 bg-amber text-noir-bg font-medium rounded hover:bg-amber-bright transition-colors"
        >
          Subscribe
        </button>
      </div>
      <p class="text-xs text-fd-muted mt-3">
        We respect your privacy. No spam, ever. Unsubscribe anytime.
      </p>
    </form>
    <p class="newsletter-success hidden text-sm text-green-400 mt-4">
      Thanks for subscribing! Check your email to confirm.
    </p>
  </div>
)}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const forms = document.querySelectorAll('.newsletter-form');

    forms.forEach(form => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formEl = e.target as HTMLFormElement;
        const emailInput = formEl.querySelector('input[name="email"]') as HTMLInputElement;
        const submitBtn = formEl.querySelector('button[type="submit"]') as HTMLButtonElement;
        const successMsg = formEl.closest('.newsletter-signup')?.querySelector('.newsletter-success');

        if (!emailInput.value) return;

        // Disable form during submission
        emailInput.disabled = true;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Subscribing...';

        // Simulate subscription (replace with actual endpoint in production)
        // In production, you would POST to a newsletter service like Buttondown, ConvertKit, etc.
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Store subscription locally (demo purposes)
        const subscriptions = JSON.parse(localStorage.getItem('fd_newsletter_subscribers') || '[]');
        if (!subscriptions.includes(emailInput.value)) {
          subscriptions.push(emailInput.value);
          localStorage.setItem('fd_newsletter_subscribers', JSON.stringify(subscriptions));
        }

        // Show success
        formEl.style.display = 'none';
        if (successMsg) {
          successMsg.classList.remove('hidden');
        }
      });
    });
  });
</script>
