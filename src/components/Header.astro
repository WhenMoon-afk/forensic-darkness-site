---
const navItems = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about' },
  { label: 'Cases', href: '/category/serial-killers' },
  { label: 'Resources', href: '/resources' },
  { label: 'Archive', href: '/blog' },
];

const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
  const basePath = import.meta.env.BASE_URL || '';
  const cleanCurrent = currentPath.replace(basePath, '').replace(/\/$/, '') || '/';
  const cleanHref = href.replace(/\/$/, '') || '/';

  if (cleanHref === '/') return cleanCurrent === '/';
  return cleanCurrent === cleanHref || cleanCurrent.startsWith(cleanHref + '/');
};
---

<header class="sticky top-0 z-50 bg-noir-base/95 backdrop-blur-sm border-b border-noir-border">
  <div class="h-px bg-gradient-to-r from-transparent via-amber to-transparent"></div>

  <div class="container">
    <nav class="flex items-center justify-between h-16 md:h-20" aria-label="Main navigation">
      <a href="/" class="flex items-center gap-4 group">
        <div class="w-10 h-10 bg-noir-surface border border-noir-border flex items-center justify-center group-hover:border-amber transition-colors duration-300">
          <div class="w-4 h-4 bg-amber" style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></div>
        </div>

        <div class="hidden sm:block">
          <div class="font-display text-xl font-bold text-paper-aged group-hover:text-amber transition-colors tracking-tight">
            Forensic Darkness
          </div>
          <div class="font-mono text-xs text-paper-dim uppercase tracking-widest">
            Case Files
          </div>
        </div>
      </a>

      <div class="hidden md:flex items-center gap-6">
        {navItems.map(item => (
          <a
            href={item.href}
            class:list={[
              'nav-link',
              isActive(item.href) && 'active'
            ]}
            aria-current={isActive(item.href) ? 'page' : undefined}
          >
            {item.label}
          </a>
        ))}
        <a
          href="/search"
          class:list={[
            'p-2 text-paper-muted hover:text-amber transition-colors duration-200',
            isActive('/search') && 'text-amber'
          ]}
          aria-label="Search archives"
          aria-current={isActive('/search') ? 'page' : undefined}
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </a>
      </div>

      <button
        id="mobile-menu-btn"
        class="md:hidden p-2 text-paper-muted hover:text-amber transition-colors"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg class="w-6 h-6 menu-open" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg class="w-6 h-6 menu-close hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </nav>

    <div id="mobile-menu" class="hidden md:hidden pb-6" role="menu">
      <div class="border-t border-noir-border pt-4">
        <div class="flex flex-col gap-1">
          {navItems.map(item => (
            <a
              href={item.href}
              class:list={[
                'nav-link px-4 py-3 hover:bg-noir-surface transition-colors flex items-center gap-3',
                isActive(item.href) && 'active bg-noir-surface'
              ]}
              aria-current={isActive(item.href) ? 'page' : undefined}
              role="menuitem"
            >
              <span class="w-1.5 h-1.5 bg-amber" style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></span>
              {item.label}
            </a>
          ))}
          <a
            href="/search"
            class:list={[
              'nav-link px-4 py-3 hover:bg-noir-surface flex items-center gap-3',
              isActive('/search') && 'active bg-noir-surface'
            ]}
            aria-current={isActive('/search') ? 'page' : undefined}
            role="menuitem"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Search Archives
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuOpen = menuBtn?.querySelector('.menu-open');
  const menuClose = menuBtn?.querySelector('.menu-close');

  menuBtn?.addEventListener('click', () => {
    const isHidden = mobileMenu?.classList.toggle('hidden');
    menuBtn.setAttribute('aria-expanded', isHidden ? 'false' : 'true');
    menuOpen?.classList.toggle('hidden');
    menuClose?.classList.toggle('hidden');
  });
</script>
