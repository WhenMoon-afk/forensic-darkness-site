---
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import SiteContentNotice from '../components/SiteContentNotice.astro';
import { getCollection } from 'astro:content';
import { getReadingTime, getExcerpt, getFirstImage, generateCaseNumber } from '../utils/content';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const featuredPost = sortedPosts[0];
const recentPosts = sortedPosts.slice(1, 7);
---

<BaseLayout title="Forensic Darkness">
  <!-- Hero Section -->
  <section class="relative py-20 lg:py-32 overflow-hidden">
    <div class="absolute inset-0 opacity-5">
      <div class="absolute inset-0" style="background-image: repeating-linear-gradient(90deg, transparent, transparent 100px, rgba(201, 162, 39, 0.1) 100px, rgba(201, 162, 39, 0.1) 101px);"></div>
    </div>

    <div class="container text-center relative">
      <div class="inline-flex items-center gap-3 mb-8">
        <div class="h-px w-12 bg-gradient-to-r from-transparent to-amber"></div>
        <span class="font-mono text-xs uppercase tracking-[0.3em] text-amber">Case Files Archive</span>
        <div class="h-px w-12 bg-gradient-to-l from-transparent to-amber"></div>
      </div>

      <h1 class="text-5xl md:text-6xl lg:text-7xl font-display font-bold mb-6 leading-tight text-paper-aged">
        Forensic Darkness
      </h1>
      <p class="text-xl md:text-2xl text-amber max-w-3xl mx-auto mb-6 font-display">
        Serial Killers & Awareness
      </p>
      <p class="text-lg text-paper-muted max-w-2xl mx-auto mb-10 leading-relaxed">
        Victims being informed with help and resources. Exploring criminal psychology, forensic science, and providing support for crime victims.
      </p>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a href="/blog" class="btn btn-primary">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Browse Case Files
        </a>
        <a href="/resources" class="btn btn-secondary">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          Victim Resources
        </a>
      </div>

      <div class="mt-16 grid grid-cols-3 gap-8 max-w-xl mx-auto">
        <div class="text-center">
          <div class="text-3xl font-display font-bold text-amber">{posts.length}</div>
          <div class="text-xs font-mono uppercase tracking-wider text-paper-dim mt-1">Case Files</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-display font-bold text-amber">24/7</div>
          <div class="text-xs font-mono uppercase tracking-wider text-paper-dim mt-1">Crisis Support</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-display font-bold text-amber">4</div>
          <div class="text-xs font-mono uppercase tracking-wider text-paper-dim mt-1">Resource Categories</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Content Notice -->
  <div class="container pt-8">
    <SiteContentNotice />
  </div>

  <!-- Mission Statement -->
  <section class="py-16 border-b border-noir-border">
    <div class="container">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-2xl md:text-3xl font-display font-bold mb-6">Don't Be Scared, Be Aware!</h2>
        <p class="text-paper-muted text-lg leading-relaxed">
          Serial killers don't just hatch overnightâ€”they are the product of years of circumstances and thought processes. This site provides information about mental illnesses and personality disorders common among offenders, as well as help for victims and families. We need to know our enemy to educate our children on how to stay safe.
        </p>
      </div>
    </div>
  </section>

  <!-- Featured Article -->
  {featuredPost && (
    <section class="py-16 border-b border-noir-border">
      <div class="container">
        <div class="flex items-center gap-3 mb-8">
          <div class="w-2 h-2 bg-amber" style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></div>
          <h2 class="font-mono text-sm uppercase tracking-widest text-amber">Featured Case File</h2>
        </div>

        <a href={`/blog/${featuredPost.data.slug || featuredPost.slug}`} class="group block">
          <article class="grid md:grid-cols-2 gap-8 items-center">
            <div class="relative aspect-video overflow-hidden border border-noir-border group-hover:border-amber transition-colors">
              {(featuredPost.data.image || getFirstImage(featuredPost.body)) ? (
                <img
                  src={featuredPost.data.image || getFirstImage(featuredPost.body)}
                  alt={featuredPost.data.title}
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                  loading="eager"
                />
              ) : (
                <div class="w-full h-full bg-noir-surface flex items-center justify-center">
                  <div class="w-16 h-16 bg-amber/20" style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></div>
                </div>
              )}
              <div class="absolute inset-0 bg-gradient-to-t from-noir-base/60 to-transparent"></div>
              <div class="absolute bottom-4 left-4">
                <span class="evidence-tag">Featured</span>
              </div>
            </div>

            <div>
              <div class="case-number mb-3 opacity-60">
                Case #{generateCaseNumber(featuredPost.data.date)}
              </div>

              <h3 class="text-2xl md:text-3xl lg:text-4xl font-display font-bold mb-4 text-paper-aged group-hover:text-amber transition-colors leading-tight">
                {featuredPost.data.title}
              </h3>

              <p class="text-paper-muted mb-6 line-clamp-3">
                {getExcerpt(featuredPost.body)}
              </p>

              <div class="flex items-center gap-4 text-xs text-paper-dim font-mono uppercase tracking-wider mb-6">
                <time datetime={featuredPost.data.date}>
                  {new Date(featuredPost.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                </time>
                <span class="text-noir-border">|</span>
                <span>{getReadingTime(featuredPost.body)} min read</span>
              </div>

              <span class="inline-flex items-center gap-2 text-amber group-hover:gap-3 transition-all">
                Read Full Case File
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </span>
            </div>
          </article>
        </a>
      </div>
    </section>
  )}

  <!-- Recent Articles -->
  <section class="py-16">
    <div class="container">
      <div class="flex items-center justify-between mb-10">
        <h2 class="text-2xl md:text-3xl font-display font-bold">Recent Case Files</h2>
        <a href="/blog" class="text-amber hover:text-amber-bright flex items-center gap-2">
          View All
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {recentPosts.map(post => (
          <ArticleCard
            title={post.data.title}
            slug={post.data.slug || post.slug}
            date={post.data.date}
            excerpt={getExcerpt(post.body)}
            image={post.data.image || getFirstImage(post.body)}
            tags={post.data.tags}
            readingTime={getReadingTime(post.body)}
          />
        ))}
      </div>

      {recentPosts.length === 0 && (
        <p class="text-center text-paper-muted py-12 animate-fade-in">No articles yet. Check back soon!</p>
      )}
    </div>
  </section>

  <!-- Resource Cards -->
  <section class="py-16 bg-noir-surface/50">
    <div class="container">
      <h2 class="text-2xl md:text-3xl font-display font-bold text-center mb-10">Victim Resources</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <a href="https://ovc.ojp.gov/" target="_blank" rel="noopener noreferrer" class="card hover:border-amber transition-colors group">
          <h3 class="font-display font-bold mb-2 group-hover:text-amber">Office for Victims of Crime</h3>
          <p class="text-sm text-paper-muted">Federal resources and support for crime victims</p>
        </a>

        <a href="https://www.thehotline.org/" target="_blank" rel="noopener noreferrer" class="card hover:border-amber transition-colors group">
          <h3 class="font-display font-bold mb-2 group-hover:text-amber">National DV Hotline</h3>
          <p class="text-sm text-paper-muted">1-800-799-7233 - 24/7 support for domestic violence</p>
        </a>

        <a href="https://988lifeline.org/" target="_blank" rel="noopener noreferrer" class="card hover:border-amber transition-colors group">
          <h3 class="font-display font-bold mb-2 group-hover:text-amber">988 Suicide & Crisis Lifeline</h3>
          <p class="text-sm text-paper-muted">Call or text 988 for mental health crisis support</p>
        </a>

        <a href="https://www.doenetwork.org/" target="_blank" rel="noopener noreferrer" class="card hover:border-amber transition-colors group">
          <h3 class="font-display font-bold mb-2 group-hover:text-amber">Doe Network</h3>
          <p class="text-sm text-paper-muted">Help identify missing persons and unidentified remains</p>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
